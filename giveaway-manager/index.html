<!doctype html>
<html lang="en">

<head>
   <meta charset="utf-8">
   <title>Giveaway Manager - bitcoin data.science</title>
   <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
   <meta name="description"
      content="Manage your giveaways easily. Pick winners using provably fair method based on bitcoin blockhash.">
   <meta name="robots" content="index, follow" />
   <meta name="keywords"
      content="Giveaway Manager,bitcointalk giveaway, giveaways, Raffle, Raffle Manager, blockhash giveaway, blockhash raffle" />
   <link rel="shortcut icon" href="img/favicon.svg">
   <link rel="canonical" href="https://bitcoindata.science/bitcoin-balance-check.html">
   <link rel="alternate" hreflang="x-default" href="https://bitcoindata.science" />
   <link rel="apple-touch-icon" sizes="180x180" href="img/apple-touch-icon.png">
   <link rel="icon" type="image/png" sizes="32x32" href="img/favicon-32x32.png">
   <link rel="icon" type="image/png" sizes="16x16" href="img/favicon-16x16.png">
   <link rel="manifest" href="manifest.json" />
   <link rel="mask-icon" href="img/safari-pinned-tab.svg" color="#111316">
   <meta name="apple-mobile-web-app-title" content="bitcoin data.science">
   <meta name="application-name" content="bitcoin data.science">
   <meta name="msapplication-TileColor" content="#2b5797">
   <meta name="theme-color" content="#111316">
   <meta property="og:title" content="Giveaway Manager - bitcoin data.science" />
   <meta property="og:type" content="website" />
   <meta property="og:url" content="https://bitcoindata.science/" />
   <meta property="og:image" content="https://bitcoindata.science/img/logo.png" />
   <meta property="og:description"
      content="Manage your giveaways easily. Pick winners using provably fair method based on bitcoin blockhash." />
   <meta property="og:locale" content="en_US" />
   <meta property="og:site_name" content="bitcoin data.science" />
   <script type="application/ld+json">
      {
         "@context": "https://schema.org",
         "@graph": [{
            "@type": "WebPage",
            "name": "Giveaway Manager - Provably Fair Raffle Tool",
            "description": "Manage your giveaways easily. Pick winners using provably fair method based on bitcoin blockhash.",
            "alternateName": [
              "bitcoindata.science",
              "Bitcoin Data Science",
              "bitcoin datascience"
            ],
            "url": "https://bitcoindata.science",
            "sameAs": [
              "https://bitcoindata.science"
            ]
            } , {
               "@type": "FAQPage",
               "mainEntity": [
                 {
                   "@type": "Question",
                   "name": "How to run a Provably Fair Giveaway using Bitcoin Blockhash?",
                   "acceptedAnswer": {
                     "@type": "Answer",
                     "text": "To run a provably fair giveaway, enter the list of competitors, specify the target Bitcoin block number, and the number of winners. The tool will use the blockhash of the specified block to randomly select winners from the list of competitors."
                   }
                 }
               ]
             }
             ]
       }
   </script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
  <link href="../css/style.css" rel="stylesheet">
  <script src="../components/navbar.js" defer></script>
  <script src="../components/footer.js" defer></script>
  <script src="../components/ad.js" defer></script>
</head>

<body>
  <header>
    <base href="/" />
    <navbar-component></navbar-component>
  </header>
  <main class="container-fluid col-lg-10 col-xl-8">
    <ad-component></ad-component>
    <h1 class="h1 display-3 fw-bold">Bitcointalk Giveaway Manager</h1>

    <h2 id="giveaway_name"></h2>
    <form action="javascript:go()" class="bg-body-tertiary rounded-top-4 p-md-5 p-4 mt-5">
      <div class="mb-3">
        <label for="manually" class="form-label">Add competitors in order</label>
        <div class="small text-muted mb-2">One competitor per line
        </div>
        <textarea class="form-control border-0 bg-body-secondary rounded-2 lh-base fw-medium" id="manually" rows="6">satoshi&#10;Finney</textarea>
      </div>

      <div class="mb-3">
        <label for="block" class="form-label">How many winners?</label>
        <div class="small text-muted mb-2">max: 30</div>
        <input type="number" min="1" step="1" max="30"
          onkeypress="return (event.charCode == 8 || event.charCode == 0 || event.charCode == 13) ? null : event.charCode >= 48 && event.charCode <= 57"
          class="form-control border-0 bg-body-secondary rounded-2 lh-base fw-medium" id="n_winners" value="1">
      </div>

      <div class="mb-3">
        <label for="block" class="form-label">Target Block</label>
        <input type="number" min="0" step="1"
          onkeypress="return (event.charCode == 8 || event.charCode == 0 || event.charCode == 13) ? null : event.charCode >= 48 && event.charCode <= 57"
          class="form-control border-0 bg-body-secondary rounded-2 lh-base fw-medium" id="block" value="0">
      </div>

      <div class="form-group row gap-1 mt-4">
        <div class="col-auto">
          <button type="submit" class="btn btn-primary d-inline-block btn-lg px-5" id="submitbutton">Submit</button>
        </div>
        <div class="col-auto">
          <button type="button" class="btn btn-secondary d-inline-block btn-lg px-4" onclick="save_share()">Share</button>
        </div>
        <div class="col-lg">
          <label for="url" class="visually-hidden">Share URL</label>
          <input type="url" class="form-control-lg border-0 bg-body-secondary rounded-2 lh-base fw-normal fs-6 h-100 font-monospace w-100" id="url" readonly onclick="copyurl()" data-toggle="tooltip"
            data-placement="top" title="Click to copy to clipboard">
        </div>

      </div>
    </form>

    <div class="bg-body-tertiary rounded-0 p-md-5 p-4 mt-2">
      <h3 class="mb-4">Results</h3>
      <p>Block hash: <output id="block-output"></output></p>
      <div id="verify"></div>
      <p>Decimal number: <code class="text-primary" id="rolled-number"></code></p>
      <p><strong>Winner: </strong><span class="h4"><span id="winner" class="badge text-bg-success "></span></span></p>
      <output id="n_winner_div"></output>
    </div>

    <article class="bg-body-tertiary rounded-bottom-4 p-md-5 p-4 mt-2">
      <h3 class="h4 pb-2 mb-4">Provably fair giveaway manager</h3>
      <p>
        As the <code>blockhash</code> is just a number, its last 6 digits is converted to <code>decimal</code> using
        this function:</p>

      <code class="text-primary">var decimal =  parseInt(blockhash.slice(-6), 16);</code>
      <p></p>
      <p>Now we have an integer (0 to 16777215) from the <code>blockhash</code>.</p>

      <p>After dividing this <code>decimal</code> by the number of participants, we use the <i>modulo operator
          (<code>%</code>)</i>
        to get the division remainder becomes
        the <code>index_number</code>.</p>

      <p>This <code>index_number</code> is applied in the participants list, to get the position of the winner.</p>

      <code class="text-primary">
          var index_number = decimal % competitors.length;</code>
      <br />
      <code class="text-primary">
          var winner = competitors[index_number];
        </code>

      <p></p>

      <p>For additional winners, the past winners are removed from the list and one more digit is added from the
        blockhash. A maximum 30 was added to avoid working with big numbers.</p>

    </article>
  </main>
   <footer-component></footer-component>

  <script src="https://code.jquery.com/jquery-3.5.1.min.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"
    integrity="sha512-E8QSvWZ0eCLGk4km3hxSsNmGWbLtSCSUcewDQPQWZF6pEU8GlT8a5fF32wOl1i8ftdMhssTrF/OhyGWwonTcXA=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <script>
    $(function () {
      $('[data-toggle="tooltip"]').tooltip()
    })

    function go() {
      document.getElementById('submitbutton').innerText = "Loading...";
      document.getElementById("winner").innerHTML = "";

      //clear n_winner_div without page reload
      document.getElementById("n_winner_div").innerHTML = '';
      var competitors = document.getElementById("manually").value.split("\n")
      competitors = competitors.filter(n => n)

      var blockdata = $.ajax('https://mempool.space/api/block-height/' + document.getElementById("block").value)
        .done(function (blockhash) {
          let block = document.getElementById("block").value
          var n_winners = document.getElementById("n_winners").value
          let decimal = parseInt(blockhash.slice(-6), 16)
          let index_number = decimal % competitors.length
          let winner = competitors[index_number];

          document.getElementById("block-output").innerHTML = "<code class='text-primary'>" + blockhash + "</code> <a class='small text-muted' target='_blank' href='https://mempool.space/block/" + block + "'>Verify</a>";
          document.getElementById("rolled-number").innerHTML = decimal;
          document.getElementById("winner").innerHTML = winner

          competitors.splice(index_number, 1)
        })
        .done(function (blockhash) {
          if (document.getElementById("n_winners").value > 1 && document.getElementById("n_winners").value < 31) {
            for (let step = 1; step < document.getElementById("n_winners").value; step++) {
              // As suggested by PowerGlove
              let n_winner_decimal = parseInt(blockhash.slice(-(6 + step), blockhash.length - step), 16)

              let n_winner_index_number = n_winner_decimal % competitors.length
              let n_winner = competitors[n_winner_index_number];
              competitors.splice(n_winner_index_number, 1)
              n_winner !== undefined ?
                document.getElementById("n_winner_div").innerHTML +=
                '<p><strong>Winner ' + (step + 1) + ': </strong><span class="h4"><span class="badge text-bg-success ">' + n_winner + '</span></span></p>'
                : ''
            }
          }
        }
        )
        .fail(function (XMLHttpRequest, textStatus, errorData) {
          if (XMLHttpRequest.readyState == 4) {

            //   Get time of future block
            $.ajax('https://mempool.space/api/blocks/tip/height')
              .done(function (blockheight) {
                var blockdelta = document.getElementById("block").value - blockheight
                console.log(blockdelta)
                var fblocktime = new Date(new Date().getTime() + 10 * 60000 * blockdelta);
                document.getElementById("block-output").innerHTML = "Block <code>" + document.getElementById("block").value + "</code> not mined yet.<br/> Will probably be mined at <time style='color:var(--bs-code-color);' class='font-monospace'>" + fblocktime + "</time>";
                document.getElementById("rolled-number").innerHTML = '';

              })
          }
        })
        .always(function () {
          document.getElementById('submitbutton').innerText = "Submit";
        });
    }

    // saved and share
    function copyurl() {
      navigator.clipboard.writeText(document.getElementById('url').value)
    }

    function save_share() {
      let competitors_for_share = document.getElementById("manually").value
      let share_block = document.getElementById("block").value
      let share_n_winners = document.getElementById("n_winners").value
      let encrypted = CryptoJS.AES.encrypt(share_block + '&' + share_n_winners + '&' + competitors_for_share, "bitcoin");
      document.getElementById("url").value = 'https://bitcoindata.science/giveaway-manager/?' + encrypted;
    }

    //load saved data
    if (window.location.search) {
      var decrypted = CryptoJS.AES.decrypt(window.location.search.substring(1), "bitcoin");
      var saved_data = decrypted.toString(CryptoJS.enc.Utf8);
      var saved_data_array = saved_data.split("&");

      document.getElementById("block").value = saved_data_array[0]
      document.getElementById("n_winners").value = saved_data_array[1]
      document.getElementById("manually").value = saved_data_array[2]
    }
    else {
      // get last block height
      $.ajax('https://mempool.space/api/blocks/tip/height')
        .done(function (blockheight) {
          document.getElementById("block").value = blockheight
        })
    }

  </script>
</body>

</html>